<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mody Poetry</title>
  <meta name="description" content="Ù…Ø¬Ù†ÙˆÙ† Ø§Ù„Ø´ÙØ¹Ø± â€” Ù…Ø¬Ù…ÙˆØ¹ØªÙŠ Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©" />
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-gradient-1:#fff8f0;
      --bg-gradient-2:#fef3e8;
      --card:#ffffff;
      --card-hover:#fffbf5;
      --muted:#8b7355;
      --accent:#3a1f0b;
      --brown:#8b5e3c;
      --brown-hover:#a67c52;
      --text:#2e1a0f;
      --shadow:rgba(58,31,11,0.08);
      --shadow-lg:rgba(58,31,11,0.12);
      --border:#e8dcc8;
      --placeholder:rgba(139,94,60,0.08);
      --header-dark:#e8d2bf; 
      --header-dark-2:#d9c0a6;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow-x:hidden}
    body{
      font-family:'Cairo',system-ui,sans-serif;
      background:linear-gradient(135deg,var(--bg-gradient-1) 0%,var(--bg-gradient-2) 100%);
      background-attachment:fixed;
      color:var(--text);
      line-height:1.7;
      padding:0;
    }
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{
      background:linear-gradient(180deg,var(--header-dark) 0%, var(--header-dark-2) 100%);
      backdrop-filter:blur(6px);
      border-bottom:1px solid rgba(0,0,0,0.06);
      position:sticky;
      top:0;
      z-index:100;
      box-shadow:0 6px 28px rgba(0,0,0,0.08);
    }
    .header-content{
      max-width:1100px;
      margin:0 auto;
      padding:14px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .brand-icon{
      width:48px;
      height:48px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:28px;
      background:rgba(58,31,11,0.06);
      color:var(--brown);
      box-shadow:0 4px 12px rgba(0,0,0,0.06);
    }
    .brand h1{font-size:20px;font-weight:700;color:var(--accent)}
    .brand p{font-size:13px;color:rgba(0,0,0,0.45);margin-top:2px}
    nav{display:flex;gap:8px;align-items:center;position:relative}
    .btn{
      padding:8px 12px;
      border-radius:8px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      border:1.4px solid var(--brown);
      background:#fff;
      color:#5a3f2a;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:all .18s ease;
    }
    .btn:hover{background:#f5ebe0;border-color:var(--brown-hover)}
    .small{padding:6px 10px;font-size:13px}
    .hero{
      background:linear-gradient(135deg,rgba(255,255,255,0.92) 0%,rgba(255,251,245,0.92) 100%);
      backdrop-filter:blur(8px);
      border-radius:14px;
      padding:16px;
      margin:18px 0;
      box-shadow:0 8px 32px var(--shadow-lg);
      border:1px solid var(--border);
    }
    .search-wrapper{display:flex;gap:8px;flex-wrap:wrap}
    input[type="search"]{flex:1;min-width:200px;padding:10px 12px;border-radius:8px;border:1.5px solid #e8dcc8;font-size:15px;background:#fff}
    .tags-wrapper{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;align-items:center;}
    .tag{padding:7px 12px;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;border:1.2px solid #d4c4b0;background:#fff;color:#5a3f2a;transition:all .18s ease;}
    .tag:hover{background:#f5ebe0;border-color:var(--brown)}
    .tag.active{background:#f5ebe0;border-color:var(--brown);box-shadow:0 6px 14px rgba(58,31,11,0.06)}
    .muted{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;margin-top:18px;}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 8px 20px rgba(0,0,0,0.04);border:1px solid var(--border);transition:all .16s ease;display:flex;gap:10px;align-items:flex-start;user-select:none;cursor:pointer;}
    .card:hover{transform:translateY(-4px)}
    .card .drag-handle{flex:0 0 36px;display:flex;align-items:center;justify-content:center;border-radius:8px;font-size:17px;color:var(--brown);user-select:none}
    .card .content{flex:1}
    .card h3{font-family:'Amiri',serif;margin:0 0 6px 0;color:var(--accent);font-size:18px}
    .excerpt{font-family:'Amiri',serif;color:var(--muted);line-height:1.9;font-size:15px;min-height:56px}
    .card-footer{margin-top:8px;display:flex;justify-content:space-between;gap:8px;align-items:center}
    .card-tag{padding:4px 8px;border-radius:12px;font-size:12px;background:rgba(139,94,60,0.12);color:var(--brown);font-weight:700}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;padding:18px;z-index:1200;display:none;}
    .modal-inner{background:var(--card);max-width:820px;width:100%;border-radius:12px;padding:20px;max-height:90vh;overflow:auto;box-shadow:0 30px 60px rgba(0,0,0,.25);border:1px solid var(--border)}
    .modal-title{font-family:'Amiri',serif;font-size:22px;margin-bottom:6px;color:var(--accent)}
    .poem-text{font-family:'Amiri',serif;white-space:pre-line;font-size:18px;line-height:2;margin-top:12px;color:var(--text);text-align:justify}
    footer{text-align:center;color:var(--muted);margin-top:36px;padding:20px;font-size:13px}
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="brand">
        <div class="brand-icon">â˜•</div>
        <div>
          <h1>Mody Poetry</h1>
          <p class="muted">Ù‚ØµØ§Ø¦Ø¯ Ù…ÙˆØ¯ÙŠ Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© â€”Ø§Ø¶Ù ÙˆØ´Ø§Ø±Ùƒ ÙˆØ§Ø³ØªÙ…Ø¹</p>
        </div>
      </div>
      <nav>
        <div style="position:relative">
          <button class="btn small" id="menuBtn">â˜° Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
          <div id="menuDropdown" style="display:none;position:absolute;right:0;top:40px;background:var(--card);border:1px solid var(--border);border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,0.12);z-index:150;flex-direction:column;min-width:180px">
            <button class="btn small dropdown-item" id="btnAdd">âœï¸ Ø£Ø¶Ù</button>
            <button class="btn small dropdown-item" id="btnDownload">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
            <button class="btn small dropdown-item" id="btnRestoreOriginal">ğŸ”„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† GitHub</button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <div class="container">
    <section class="hero">
      <div class="search-wrapper">
        <input id="searchInput" type="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ù†Øµ..." />
      </div>
      <div id="tagsWrapper" class="tags-wrapper"></div>
    </section>

    <section id="listSection">
      <div id="poemGrid" class="grid" aria-live="polite"></div>
      <div id="emptyState" style="display:none;margin-top:18px;padding:18px;border-radius:12px;border:2px dashed var(--border);text-align:center">
        <div style="font-size:28px">ğŸ“œ</div>
        <div style="font-weight:700;margin-top:8px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ØµØ§Ø¦Ø¯</div>
        <div class="muted" style="margin-top:6px">Ø§Ø¶ØºØ· "Ø£Ø¶Ù" Ù„Ø¥Ø¶Ø§ÙØ© Ù‚ØµÙŠØ¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
      </div>
    </section>
  </div>

  <!-- Modal Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµÙŠØ¯Ø© -->
  <div id="poemModal" class="modal">
    <div class="modal-inner">
      <h2 class="modal-title"></h2>
      <pre class="poem-text"></pre>
      <button class="btn" id="closePoemModal">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <footer>
    Â© <span id="year"></span> Ù…Ø¬Ù†ÙˆÙ† Ø§Ù„Ø´ÙØ¹Ø± â€” All rights reserved
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    const STORAGE_KEY = 'mody_poems_v_full_v1';
    const GITHUB_JSON = 'https://raw.githubusercontent.com/abdomedo2033-code/ModyPoetry/main/poems.json';
    let poems = [];
    let originalPoems = null;
    let activeTag = null;

    const poemGrid = document.getElementById('poemGrid');
    const emptyState = document.getElementById('emptyState');
    const searchInput = document.getElementById('searchInput');
    const tagsWrapper = document.getElementById('tagsWrapper');
    const year = document.getElementById('year');
    const btnDownload = document.getElementById('btnDownload');
    const btnRestoreOriginal = document.getElementById('btnRestoreOriginal');
    const btnAdd = document.getElementById('btnAdd');
    const addModal = document.getElementById('addModal');
    const menuBtn = document.getElementById('menuBtn');
    const menuDropdown = document.getElementById('menuDropdown');
    const poemModal = document.getElementById('poemModal');

    year.textContent = new Date().getFullYear();

    function escapeHtml(text) { const d = document.createElement('div'); d.textContent = text||''; return d.innerHTML; }

    async function loadPoemsFromGitHub(){
      try{
        const res = await fetch(GITHUB_JSON);
        if(!res.ok) throw new Error('Failed to fetch JSON');
        const data = await res.json();
        if(Array.isArray(data)){
          poems = data;
          originalPoems = JSON.parse(JSON.stringify(data));
          localStorage.setItem(STORAGE_KEY, JSON.stringify(poems));
          renderPoems();
          renderTags();
        } else alert('Ù…Ù„Ù JSON ØºÙŠØ± ØµØ§Ù„Ø­');
      } catch(err){ alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ØµØ§Ø¦Ø¯ Ù…Ù† GitHub'); console.error(err);}
    }

    function renderPoems(){
      const query = searchInput.value.toLowerCase();
      const filtered = poems.filter(p=>{
        const matchText = (p.title+p.text).toLowerCase().includes(query);
        const matchTag = activeTag ? p.tags.includes(activeTag) : true;
        return matchText && matchTag;
      });
      poemGrid.innerHTML='';
      if(!filtered.length){ emptyState.style.display='block'; return; }
      emptyState.style.display='none';
      filtered.forEach((p,i)=>{
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML=`<div class="drag-handle">â˜°</div><div class="content"><h3>${escapeHtml(p.title)}</h3><div class="excerpt">${escapeHtml(p.excerpt||p.text.slice(0,140))}</div><div class="card-footer"><span class="card-tag">${(p.tags||[]).join(', ')}</span></div></div>`;
        card.onclick=()=>openPoemModal(p);
        poemGrid.appendChild(card);
      });
      new Sortable(poemGrid,{handle:'.drag-handle',animation:150,onEnd:e=>{const moved=poems.splice(e.oldIndex,1)[0];poems.splice(e.newIndex,0,moved);localStorage.setItem(STORAGE_KEY,JSON.stringify(poems));}});
    }

    function renderTags(){
      const allTags=[...new Set(poems.flatMap(p=>p.tags||[]))];
      tagsWrapper.innerHTML='';
      allTags.forEach(tag=>{
        const t=document.createElement('div');
        t.className='tag'+(activeTag===tag?' active':'');
        t.textContent=tag;
        t.onclick=()=>{activeTag=activeTag===tag?null:tag; renderPoems(); renderTags();}
        tagsWrapper.appendChild(t);
      });
    }

    function openPoemModal(poem){
      poemModal.querySelector('.modal-title').textContent = poem.title;
      poemModal.querySelector('.poem-text').textContent = poem.text;
      poemModal.style.display = 'flex';
    }
    poemModal.querySelector('#closePoemModal').onclick = ()=>poemModal.style.display='none';

    menuBtn.addEventListener('click',()=>{menuDropdown.style.display=menuDropdown.style.display==='flex'?'none':'flex';});
    document.addEventListener('click',e=>{if(!menuBtn.contains(e.target)&&!menuDropdown.contains(e.target)){menuDropdown.style.display='none';}});

    btnDownload.addEventListener('click',()=>{
      const dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(poems));
      const dlAnchor = document.createElement('a');
      dlAnchor.setAttribute('href',dataStr);
      dlAnchor.setAttribute('download','mody_poems.json');
      dlAnchor.click();
    });

    btnRestoreOriginal.addEventListener('click', loadPoemsFromGitHub);

    searchInput.addEventListener('input', renderPoems);

    // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ Ù…Ù† GitHub Ø£Ùˆ fallback Ù„Ù„Ù€ localStorage
    (async()=>{
      const stored = localStorage.getItem(STORAGE_KEY);
      if(stored){
        poems = JSON.parse(stored);
        originalPoems = JSON.parse(stored);
        renderPoems();
        renderTags();
      }
      await loadPoemsFromGitHub();
    })();
  </script>
</body>
</html>
